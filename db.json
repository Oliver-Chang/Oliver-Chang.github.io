{"meta":{"version":1,"warehouse":"3.0.1"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"themes/melody/source/melody-favicon.ico","path":"melody-favicon.ico","modified":0,"renderable":1},{"_id":"themes/melody/source/js/hexo-theme-melody.js","path":"js/hexo-theme-melody.js","modified":0,"renderable":1},{"_id":"themes/melody/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/melody/source/img/avatar.png","path":"img/avatar.png","modified":0,"renderable":1},{"_id":"themes/melody/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/melody/source/js/copy.js","path":"js/copy.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/fancybox.js","path":"js/fancybox.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/fireworks.js","path":"js/fireworks.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/head.js","path":"js/head.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/scroll.js","path":"js/scroll.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/sidebar.js","path":"js/sidebar.js","modified":0,"renderable":1},{"_id":"themes/melody/source/css/404.styl","path":"css/404.styl","modified":0,"renderable":1},{"_id":"themes/melody/source/js/katex.js","path":"js/katex.js","modified":0,"renderable":1},{"_id":"themes/melody/source/img/algolia.svg","path":"img/algolia.svg","modified":0,"renderable":1},{"_id":"themes/melody/source/js/transition.js","path":"js/transition.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/canvas-ribbon.js","path":"js/third-party/canvas-ribbon.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/anime.min.js","path":"js/third-party/anime.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/jquery.fancybox.min.js","path":"js/third-party/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/velocity.min.js","path":"js/third-party/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/velocity.ui.min.js","path":"js/third-party/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/jquery.min.js","path":"js/third-party/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/marked.min.js","path":"js/third-party/reveal/marked.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/head.min.js","path":"js/third-party/reveal/head.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/reveal.min.js","path":"js/third-party/reveal/reveal.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/notes.min.js","path":"js/third-party/reveal/notes.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/math.min.js","path":"js/third-party/reveal/math.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/zoom.min.js","path":"js/third-party/reveal/zoom.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/markdown.min.js","path":"js/third-party/reveal/markdown.min.js","modified":0,"renderable":1},{"_id":"themes/melody/source/js/third-party/reveal/highlight.min.js","path":"js/third-party/reveal/highlight.min.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"6983b3ca52b5d863579980a7ba5f0dce966dc469","modified":1572776357378},{"_id":"themes/melody/.eslintignore","hash":"55f36fe3be2270ae2746eddbb2982e4e1472bc31","modified":1572760178409},{"_id":"themes/melody/.git","hash":"e6794e173017140bda10dd4facd15cda2ca2d0fa","modified":1572760178393},{"_id":"themes/melody/.eslintrc","hash":"cfcd1b454efdd6cc1a0d43be7bc79027b84531f7","modified":1572760178409},{"_id":"themes/melody/.gitignore","hash":"7ed73f0edfb682b12a42070fd2730d5d712ec2fa","modified":1572760178409},{"_id":"themes/melody/.travis.demo.yml","hash":"4482d40a58a035ef96888dfc4ed96c861b8f78a5","modified":1572760178409},{"_id":"themes/melody/FAQ.md","hash":"5984dd5335f8ead64f14d3885de5cc5ef09dfff8","modified":1572760178409},{"_id":"themes/melody/_config.yml","hash":"736b13f14c5ed4e4c69dbee4ca379e0bf1997968","modified":1572760178413},{"_id":"themes/melody/LICENSE","hash":"dbbc2e6e42affa5ac962826f01bffa8c7aecd6b8","modified":1572760178409},{"_id":"themes/melody/README.md","hash":"cd834f7fb2430987f16efa84fd4cd366dfe5273e","modified":1572760178413},{"_id":"themes/melody/package.json","hash":"222a9e63733787e4ff05c6027a748f93b4c232c2","modified":1572760178419},{"_id":"themes/melody/stylus_format.json","hash":"2fbe63b06901d202773457d7ce658ab6aa85d02b","modified":1572760178443},{"_id":"themes/melody/scripts/hexo-plugins.txt","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1572760178419},{"_id":"source/_data/melody.yml","hash":"a92683a214beedb3e42a54281928de5f453182a9","modified":1572763562086},{"_id":"source/_posts/hello-world.md","hash":"aab0e8284ac0e4baf9a44b2699c1cf31827e4081","modified":1572764748106},{"_id":"source/categories/index.md","hash":"c4bb07fc8abc006ca74f4d2a315f556b89683280","modified":1572762649312},{"_id":"source/tags/index.md","hash":"b1c909c98e6f9d3cb999e451ffc2ba38deeb6446","modified":1572762617129},{"_id":"themes/melody/.github/ISSUE_TEMPLATE.md","hash":"66c3f31c24530922420b92f5fd827f69197ee0e2","modified":1572760178409},{"_id":"themes/melody/.vscode/launch.json","hash":"3098e8e395a33fa130747d2fd104a21278f266a6","modified":1572760178409},{"_id":"themes/melody/.vscode/settings.json","hash":"fe06aa97b88db812231f3f1d1befe4b9b95604ea","modified":1572760178409},{"_id":"themes/melody/languages/default.yml","hash":"2af19daf22ec99daf2482af9dac5c3ff641497c4","modified":1572760178413},{"_id":"themes/melody/languages/en.yml","hash":"2af19daf22ec99daf2482af9dac5c3ff641497c4","modified":1572760178413},{"_id":"themes/melody/languages/zh-Hans.yml","hash":"68c5794ec57227daec2e3afe2c5d502fa0a7092a","modified":1572760178413},{"_id":"themes/melody/layout/404.pug","hash":"0ad5d251ba70edad5c04a45d13ca6a8db3bf7b42","modified":1572760178413},{"_id":"themes/melody/layout/archive.pug","hash":"2133e9f369dac19b9f843fc956521f864ace7567","modified":1572760178413},{"_id":"themes/melody/layout/category.pug","hash":"ea5f82d69e586f293f428f3b237c17bf873b4f03","modified":1572760178413},{"_id":"themes/melody/layout/gallery.pug","hash":"c083a7bbf5f46305daed74632aef3403b7d94dc7","modified":1572760178413},{"_id":"themes/melody/layout/index.pug","hash":"5e969c09fa5902829ad0b14c0af8d432bd4c7078","modified":1572760178416},{"_id":"themes/melody/layout/page.pug","hash":"64f1a6564f674a6bbc9dbcb371ae6e23c1335221","modified":1572760178416},{"_id":"themes/melody/layout/post.pug","hash":"949550f3b7195124b2ca5f34e3bdab6fd08de0d4","modified":1572760178416},{"_id":"themes/melody/layout/slides.pug","hash":"1e84a92d5b854dd233e0b511d59c1cd7c8d647a1","modified":1572760178416},{"_id":"themes/melody/layout/tag.pug","hash":"ca333911bc97bc9d3eba6e1bc05e96b209ecedfb","modified":1572760178419},{"_id":"themes/melody/scripts/gallery-tag.js","hash":"74e2e95f8daec619578f4b7dd1ed77cd5907f37e","modified":1572760178419},{"_id":"themes/melody/scripts/replace-config.js","hash":"7476015a4e091203c3048c5377ec5d67439520fa","modified":1572760178419},{"_id":"themes/melody/source/melody-favicon.ico","hash":"e33c804e570eb238fe095ed28346dd1b3a0666ae","modified":1572760178443},{"_id":"themes/melody/source/js/hexo-theme-melody.js","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1572760178423},{"_id":"themes/melody/layout/includes/additional-js.pug","hash":"c4ca62466684758d5a26e5866f9ed87b5c9401b8","modified":1572760178413},{"_id":"themes/melody/layout/includes/config.pug","hash":"b55265d49832decb34d57f222deb64f04cc9aa12","modified":1572760178413},{"_id":"themes/melody/layout/includes/footer.pug","hash":"0e9f1778f021f1c205f0b1be83014fba576797af","modified":1572760178413},{"_id":"themes/melody/layout/includes/header.pug","hash":"006f86f19256eecc05c6cc6e66d5c0c79ddfcc63","modified":1572760178416},{"_id":"themes/melody/layout/includes/head.pug","hash":"dd1427b82e118a9085e894fc062542dee0710fc1","modified":1572760178416},{"_id":"themes/melody/layout/includes/nav.pug","hash":"3f1fe059784df45f923587b81cc972659ed22e01","modified":1572760178416},{"_id":"themes/melody/layout/includes/layout.pug","hash":"58856b5048fb64e7dab75a6ae32cc2a0ad94de4f","modified":1572760178416},{"_id":"themes/melody/layout/includes/pagination.pug","hash":"fe33a94d90836b767c42654ccc4c4de7d7f227fc","modified":1572760178416},{"_id":"themes/melody/layout/includes/recent-posts.pug","hash":"128c448f5bab71f59912516edff9d476ff6b8afe","modified":1572760178416},{"_id":"themes/melody/layout/includes/sidebar.pug","hash":"211b8ecfdb7b5dd836c87436def410a52dfa5ecd","modified":1572760178416},{"_id":"themes/melody/source/css/index.styl","hash":"2053ba56db707e7a03796ba59f77103765b02353","modified":1572760178423},{"_id":"themes/melody/source/img/avatar.png","hash":"a44601fac9a81dd7e392d05ea5ddc65c96b051df","modified":1572760178423},{"_id":"themes/melody/source/css/var.styl","hash":"259feee66bf9c326e781bb63a177627dbe3eb539","modified":1572760178423},{"_id":"themes/melody/source/js/copy.js","hash":"ce7f8601c7c75ced79e2e9851beec37299d49fd1","modified":1572760178423},{"_id":"themes/melody/source/js/fancybox.js","hash":"2d3eaa654b2524c41dc5aba1d5e2e7cc9aaefd26","modified":1572760178423},{"_id":"themes/melody/source/js/fireworks.js","hash":"17d5770d46d9b531b675b129835561146290af83","modified":1572760178423},{"_id":"themes/melody/source/js/head.js","hash":"555e9caa046d5a174af8d20c75e9e89c25aabb6c","modified":1572760178423},{"_id":"themes/melody/source/js/scroll.js","hash":"50aee3035949bbc178eafd86adf19fd51916640d","modified":1572760178423},{"_id":"themes/melody/source/js/sidebar.js","hash":"a42109c5a69dedc87e1aaf8cb2383fd43069677e","modified":1572760178423},{"_id":"themes/melody/source/css/404.styl","hash":"b7a0f8b23cb137b1a6c4fa0f9a35e06e93065b2c","modified":1572760178419},{"_id":"themes/melody/source/js/katex.js","hash":"a5a999b357c0fd9aeacae721bf121f30d40d6726","modified":1572760178423},{"_id":"themes/melody/source/img/algolia.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1572760178423},{"_id":"themes/melody/source/js/transition.js","hash":"11c3b82a5e9ef2bf7bd712b6c211d86426f9a23e","modified":1572760178443},{"_id":"themes/melody/source/js/utils.js","hash":"f514662ad80803e1bb5f6bc653c4b9ad06ea4932","modified":1572760178443},{"_id":"themes/melody/layout/includes/gallery/script.pug","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1572760178413},{"_id":"themes/melody/layout/includes/404/layout.pug","hash":"9c7cdf16a9b9b4aa251dba9378a0f00d985101de","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/disqus.pug","hash":"e62b73df92566806bfb170f204295cffd7074215","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/gitalk.pug","hash":"86bdbc4a52024c3573bea27817394dd118b70a26","modified":1572760178413},{"_id":"themes/melody/layout/includes/404/404-nav.pug","hash":"4cd894857bb90fe44b55e852864692ed06588b8e","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/index.pug","hash":"6c16214e5945142e5f3b58e7694397e26f28849d","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/gitment.pug","hash":"0b7cd8b0b114876238ca022abda4c1fcdfaee12f","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/laibili.pug","hash":"97de1d1fb0459e7a2394ac2f5e449adf9b6986cb","modified":1572760178413},{"_id":"themes/melody/layout/includes/comments/valine.pug","hash":"9115ffd74549d356c18d4e2ad0a85d7b320b8c6e","modified":1572760178413},{"_id":"themes/melody/layout/includes/count/busuanzi.pug","hash":"4df5e63ab0113efb93f05ef781b2a7e3f34ba753","modified":1572760178413},{"_id":"themes/melody/layout/includes/gallery/layout.pug","hash":"8ff96c4f9afb416c5fc586c9585ae51cb6129529","modified":1572760178413},{"_id":"themes/melody/layout/includes/mixins/article-sort.pug","hash":"297b098dc6bba73b76bac4cf6bcd0c29d5dcb2ed","modified":1572760178416},{"_id":"themes/melody/layout/includes/mixins/slide.pug","hash":"91975f700b20131ab4df4d2ea3e1acc8bf2d3eef","modified":1572760178416},{"_id":"themes/melody/layout/includes/search/algolia.pug","hash":"44d5a061df53a276d22b3855652645d90117d0b6","modified":1572760178416},{"_id":"themes/melody/layout/includes/search/index.pug","hash":"b01828b37d789797aeb5433f1705cff3c540a4d5","modified":1572760178416},{"_id":"themes/melody/layout/includes/search/local-search.pug","hash":"f88070a84379bc06fb385e1193448fae6a8a54e1","modified":1572760178416},{"_id":"themes/melody/layout/includes/share/add-this.pug","hash":"17a11c1c36c9078639c2a82628ce5fc6584daffb","modified":1572760178416},{"_id":"themes/melody/layout/includes/share/index.pug","hash":"a2ec6da33cf5fa0ba6c8c38ec3841a0b0003ce98","modified":1572760178416},{"_id":"themes/melody/layout/includes/share/share-js.pug","hash":"e612725ba48711fc119f91c6196287ad13f5a2ba","modified":1572760178416},{"_id":"themes/melody/layout/includes/slide/layout.pug","hash":"f90bfc1cbe21e799a8784129e1a34bd59404e3df","modified":1572760178416},{"_id":"themes/melody/layout/includes/slide/script.pug","hash":"940c000ececf7f7596bf8c452dda9b92a5df7710","modified":1572760178416},{"_id":"themes/melody/layout/includes/third-party/canvas-ribbon.pug","hash":"39a03f188ac415642766b062a80b1b710f3ea609","modified":1572760178416},{"_id":"themes/melody/layout/includes/third-party/katex.pug","hash":"79b2336ad8d921907a5b1badc10ba1651c92843b","modified":1572760178416},{"_id":"themes/melody/layout/includes/third-party/mathjax.pug","hash":"33b350f9826795cd59d9e277a24accc8a9bc9076","modified":1572760178416},{"_id":"themes/melody/source/css/_global/index.styl","hash":"2a6195ce7e822362633ebf403c9438b42fa126bb","modified":1572760178419},{"_id":"themes/melody/source/css/_highlight/diff.styl","hash":"ffdfbf088da7bf33899557395abcac0d2bffd67d","modified":1572760178419},{"_id":"themes/melody/source/css/_highlight/highlight.styl","hash":"016c800bf7a0ef6d520e135ab69ef072760483cb","modified":1572760178419},{"_id":"themes/melody/source/css/_highlight/theme.styl","hash":"7d85860927afa1d93b4a39febff3d95a73de4c36","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/comments.styl","hash":"e58602aad6792f1a5dbda0677ecb04d21ac10e97","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/footer.styl","hash":"ca8c816bdb144503bec7e755344fb0e4e370a7bf","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/head.styl","hash":"73488de3f36369c29ecd5e0be9661bb2b508548c","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/page.styl","hash":"d2f6050bf6ef80523ed9a5a0f058fa5dbaf72ea8","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/pagination.styl","hash":"a3f52d1f7ff1eaead8df016b2a4def6f7b4e9559","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/post.styl","hash":"9fd88cc878a156e8b275c8dcb95717ca5ceea83a","modified":1572760178419},{"_id":"themes/melody/source/css/_layout/sidebar.styl","hash":"e8315401a6c791d00617c031be01f45df70fe7fd","modified":1572760178419},{"_id":"themes/melody/source/css/_search/algolia.styl","hash":"534e5641e3efe2452db95cc25ec8da0111ceadcf","modified":1572760178419},{"_id":"themes/melody/source/css/_search/index.styl","hash":"63cae4465ac54b71361c1795206534c7f2e6e5b1","modified":1572760178419},{"_id":"themes/melody/source/css/_search/local-search.styl","hash":"d7970b385265fef782cdcaaf4fe68a2217625467","modified":1572760178419},{"_id":"themes/melody/source/css/_third-party/jquery.fancybox.min.css","hash":"f9c94ec04062a1bfe1ef894c49e6ec33fa121778","modified":1572760178419},{"_id":"themes/melody/source/css/_third-party/normalize.min.css","hash":"e12eef6d6811c132f4f2fcf6c936be384191bcaf","modified":1572760178423},{"_id":"themes/melody/source/js/search/algolia.js","hash":"8d2cc7ac4a015563344a3981c3040d308489935c","modified":1572760178423},{"_id":"themes/melody/source/js/search/local-search.js","hash":"b7e77c27097d9d3ced13618912069d1ddf1cd64a","modified":1572760178423},{"_id":"themes/melody/source/js/third-party/canvas-ribbon.js","hash":"8fd084e962fb2028be9f748b5cb5f53d030d1d03","modified":1572760178423},{"_id":"themes/melody/source/js/third-party/anime.min.js","hash":"3c46c9597c721644a515c1c54ab13f46406657f7","modified":1572760178423},{"_id":"themes/melody/source/js/third-party/jquery.fancybox.min.js","hash":"2ec3ef6c31b971ba5e58eb4a0c5ede902bbdd4af","modified":1572760178426},{"_id":"themes/melody/source/js/third-party/velocity.min.js","hash":"69c85b9d6a931a7d3a5b0657e60112c31fb3b286","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/velocity.ui.min.js","hash":"d8124c091d19fa4072616a44a8897fabc6599fce","modified":1572760178443},{"_id":"themes/melody/source/js/third-party/jquery.min.js","hash":"1055018c28ab41087ef9ccefe411606893dabea2","modified":1572760178426},{"_id":"themes/melody/source/js/third-party/reveal/marked.min.js","hash":"37f3186f93ec854f56bf745a5988a89225e8da6c","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/head.min.js","hash":"8c9495c76d5aa00d3dfb88653c362fba9f10cbb2","modified":1572760178426},{"_id":"themes/melody/source/js/third-party/reveal/reveal.min.js","hash":"d8377a86451712488dea87caf5acbf8e97aa991f","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/notes.min.js","hash":"4bb2925b111467791fdef3c4e4b41993d59ce90f","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/math.min.js","hash":"779c98dbd83a528f27ea4b9f2d420c957c0939ba","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/zoom.min.js","hash":"aca47bf417d451c4d364c6eb287a230e4b462b17","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/markdown.min.js","hash":"859d70cd7c459819b90fe27afb940d16ecff6614","modified":1572760178439},{"_id":"themes/melody/source/js/third-party/reveal/highlight.min.js","hash":"10dd530e712a67f25cf27845213c0f28d2fe9e4d","modified":1572760178439},{"_id":"public/archives/index.html","hash":"aa719003aceea5ccf6e59d8f58d81dfd5e1af6f0","modified":1572780350919},{"_id":"public/categories/index.html","hash":"57c3bc788f2124515a5ae38b8aba04997aa0cfa8","modified":1572780350919},{"_id":"public/tags/index.html","hash":"dcdef64ab3e7abe520890106b90a9c4d15758a8e","modified":1572780350919},{"_id":"public/index.html","hash":"05c1f30992d77824832ccc0dbefb7ba28b760687","modified":1572780350919},{"_id":"public/archives/2018/index.html","hash":"8ebc69f1ac2c2e696869b919430466b5832acef2","modified":1572780350919},{"_id":"public/tags/Linux/index.html","hash":"d1596ba14447a24439c3856227f2488756401329","modified":1572780350919},{"_id":"public/archives/2018/04/index.html","hash":"3115344d4af7531eb081a573d957355e047259aa","modified":1572780350919},{"_id":"public/tags/GlusterFS/index.html","hash":"dfcfc1c21e5739eee7025472cb1fcfc27e353adb","modified":1572780350919},{"_id":"public/tags/Centos/index.html","hash":"5af1f41e94be17d26c50745fa45374e03dae3a0b","modified":1572780350919},{"_id":"public/categories/GlusterFS/index.html","hash":"ed64af01e63d2bd737192145390d803fbfbe9de0","modified":1572780350919},{"_id":"public/2018/04/26/hello-world/index.html","hash":"f225917a399123a4a25b60193922eddb56cd80d8","modified":1572780350919},{"_id":"public/CNAME","hash":"6983b3ca52b5d863579980a7ba5f0dce966dc469","modified":1572780350919}],"Category":[{"name":"GlusterFS","_id":"ck2iw6ja30002vuqpezbb7hmb"}],"Data":[{"_id":"melody","data":{"menu":{"Home":"/","Archives":"/archives","Tags":"/tags","Categories":"/categories"},"favicon":"/melody-favicon.ico","pwa":{"enable":false,"manifest":"/manifest.json"},"highlight_theme":"default","code_word_wrap":true,"social":{"github fa":"https://github.com/Oliver-Chang"},"algolia_search":{"enable":false,"hits":{"per_page":10}},"local_search":{"enable":false},"mathjax":{"enable":false,"cdn":"https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"enable":false,"cdn":{"css":"https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"},"hide_scrollbar":true},"fireworks":true,"baidu_analytics":null,"google_analytics":null,"tencent_analytics":null,"stylesheets":["/css/index.css"],"scripts":["/js/utils.js","/js/fancybox.js","/js/sidebar.js","/js/copy.js","/js/fireworks.js","/js/transition.js","/js/scroll.js","/js/head.js"],"cdn":{"css":{"fontawesome":"https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"},"js":{"anime":"https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js","jquery":"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js","fancybox":"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js","velocity":"https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js","velocity-ui":"https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"}},"avatar":null,"top_img":true,"top_img_height":60,"post_meta":{"date_type":"created","categories":true,"tags":true},"wordcount":{"enable":false},"toc":{"enable":true},"post_copyright":{"enable":true,"license":"CC BY-NC-SA 4.0","license_url":"https://creativecommons.org/licenses/by-nc-sa/4.0/"},"auto_excerpt":{"enable":true,"length":150},"slide":{"separator":"---","separator_vertical":"--","charset":"utf-8","theme":"black","mouseWheel":false,"transition":"slide","transitionSpeed":"default","parallaxBackgroundImage":"","parallaxBackgroundSize":"","parallaxBackgroundHorizontal":null,"parallaxBackgroundVertical":null},"addThis":{"enable":false},"disqus":{"enable":false},"since":2013,"ICP":{"enable":false},"busuanzi":{"enable":true,"site_uv":true,"site_uv_header":"<i class=\"fa fa-user\"></i>","site_uv_footer":null,"site_pv":true,"site_pv_header":"<i class=\"fa fa-eye\"></i>","site_pv_footer":null,"page_pv":true,"page_pv_header":"<i class=\"fa fa-file\"></i>","page_pv_footer":null},"canvas_ribbon":{"enable":false,"size":150,"alpha":0.6,"zIndex":-1,"click_to_change":false},"sidebar_display":"post","google_adsense":{"enable":false,"js":"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js","client":"ca-pub-...........","enable_page_level_ads":true},"google_site_verification":null,"bing_site_verification":null,"baidu_site_verification":null,"qihu_site_verification":null,"disable_baidu_transformation":true,"404Text":null}}],"Page":[{"title":"categories","date":"2019-11-03T06:30:29.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-11-03 14:30:29\ntype: \"categories\"\n---\n","updated":"2019-11-03T06:30:49.312Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ck2iw6ja00001vuqpbvg4gubc","content":"","site":{"data":{"melody":{"menu":{"Home":"/","Archives":"/archives","Tags":"/tags","Categories":"/categories"},"favicon":"/melody-favicon.ico","pwa":{"enable":false,"manifest":"/manifest.json"},"highlight_theme":"default","code_word_wrap":true,"social":{"github fa":"https://github.com/Oliver-Chang"},"algolia_search":{"enable":false,"hits":{"per_page":10}},"local_search":{"enable":false},"mathjax":{"enable":false,"cdn":"https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"enable":false,"cdn":{"css":"https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"},"hide_scrollbar":true},"fireworks":true,"baidu_analytics":null,"google_analytics":null,"tencent_analytics":null,"stylesheets":["/css/index.css"],"scripts":["/js/utils.js","/js/fancybox.js","/js/sidebar.js","/js/copy.js","/js/fireworks.js","/js/transition.js","/js/scroll.js","/js/head.js"],"cdn":{"css":{"fontawesome":"https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"},"js":{"anime":"https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js","jquery":"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js","fancybox":"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js","velocity":"https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js","velocity-ui":"https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"}},"avatar":null,"top_img":true,"top_img_height":60,"post_meta":{"date_type":"created","categories":true,"tags":true},"wordcount":{"enable":false},"toc":{"enable":true},"post_copyright":{"enable":true,"license":"CC BY-NC-SA 4.0","license_url":"https://creativecommons.org/licenses/by-nc-sa/4.0/"},"auto_excerpt":{"enable":true,"length":150},"slide":{"separator":"---","separator_vertical":"--","charset":"utf-8","theme":"black","mouseWheel":false,"transition":"slide","transitionSpeed":"default","parallaxBackgroundImage":"","parallaxBackgroundSize":"","parallaxBackgroundHorizontal":null,"parallaxBackgroundVertical":null},"addThis":{"enable":false},"disqus":{"enable":false},"since":2013,"ICP":{"enable":false},"busuanzi":{"enable":true,"site_uv":true,"site_uv_header":"<i class=\"fa fa-user\"></i>","site_uv_footer":null,"site_pv":true,"site_pv_header":"<i class=\"fa fa-eye\"></i>","site_pv_footer":null,"page_pv":true,"page_pv_header":"<i class=\"fa fa-file\"></i>","page_pv_footer":null},"canvas_ribbon":{"enable":false,"size":150,"alpha":0.6,"zIndex":-1,"click_to_change":false},"sidebar_display":"post","google_adsense":{"enable":false,"js":"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js","client":"ca-pub-...........","enable_page_level_ads":true},"google_site_verification":null,"bing_site_verification":null,"baidu_site_verification":null,"qihu_site_verification":null,"disable_baidu_transformation":true,"404Text":null,"rootConfig":{"title":"env.Title","subtitle":"","description":"","author":"Oliver Chang","language":"zh-Hans","timezone":"","url":"http://blog.oliverch.com","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"pretty_urls":{"trailing_index":true},"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":{"enable":true,"field":"site","exclude":""},"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":false,"tab_replace":""},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","use_date_for_updated":false,"per_page":10,"pagination_dir":"page","theme":"melody","deploy":{"type":""},"ignore":null,"meta_generator":true,"keywords":null,"index_generator":{"per_page":10,"order_by":"-date","path":""},"include":null,"exclude":null,"archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"category_generator":{"per_page":10},"tag_generator":{"per_page":10},"marked":{"gfm":true,"pedantic":false,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true,"sanitizeUrl":false,"headerIds":true},"server":{"port":4000,"log":false,"compress":false,"header":true}}}}},"excerpt":"","more":""},{"title":"tags","date":"2019-11-03T06:29:51.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-11-03 14:29:51\ntype: \"tags\"\n---\n","updated":"2019-11-03T06:30:17.129Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ck2iw6kst000avuqp6lqz3jaj","content":"","site":{"data":{"melody":{"menu":{"Home":"/","Archives":"/archives","Tags":"/tags","Categories":"/categories"},"favicon":"/melody-favicon.ico","pwa":{"enable":false,"manifest":"/manifest.json"},"highlight_theme":"default","code_word_wrap":true,"social":{"github fa":"https://github.com/Oliver-Chang"},"algolia_search":{"enable":false,"hits":{"per_page":10}},"local_search":{"enable":false},"mathjax":{"enable":false,"cdn":"https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"enable":false,"cdn":{"css":"https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"},"hide_scrollbar":true},"fireworks":true,"baidu_analytics":null,"google_analytics":null,"tencent_analytics":null,"stylesheets":["/css/index.css"],"scripts":["/js/utils.js","/js/fancybox.js","/js/sidebar.js","/js/copy.js","/js/fireworks.js","/js/transition.js","/js/scroll.js","/js/head.js"],"cdn":{"css":{"fontawesome":"https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"},"js":{"anime":"https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js","jquery":"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js","fancybox":"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js","velocity":"https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js","velocity-ui":"https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"}},"avatar":null,"top_img":true,"top_img_height":60,"post_meta":{"date_type":"created","categories":true,"tags":true},"wordcount":{"enable":false},"toc":{"enable":true},"post_copyright":{"enable":true,"license":"CC BY-NC-SA 4.0","license_url":"https://creativecommons.org/licenses/by-nc-sa/4.0/"},"auto_excerpt":{"enable":true,"length":150},"slide":{"separator":"---","separator_vertical":"--","charset":"utf-8","theme":"black","mouseWheel":false,"transition":"slide","transitionSpeed":"default","parallaxBackgroundImage":"","parallaxBackgroundSize":"","parallaxBackgroundHorizontal":null,"parallaxBackgroundVertical":null},"addThis":{"enable":false},"disqus":{"enable":false},"since":2013,"ICP":{"enable":false},"busuanzi":{"enable":true,"site_uv":true,"site_uv_header":"<i class=\"fa fa-user\"></i>","site_uv_footer":null,"site_pv":true,"site_pv_header":"<i class=\"fa fa-eye\"></i>","site_pv_footer":null,"page_pv":true,"page_pv_header":"<i class=\"fa fa-file\"></i>","page_pv_footer":null},"canvas_ribbon":{"enable":false,"size":150,"alpha":0.6,"zIndex":-1,"click_to_change":false},"sidebar_display":"post","google_adsense":{"enable":false,"js":"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js","client":"ca-pub-...........","enable_page_level_ads":true},"google_site_verification":null,"bing_site_verification":null,"baidu_site_verification":null,"qihu_site_verification":null,"disable_baidu_transformation":true,"404Text":null,"rootConfig":{"title":"env.Title","subtitle":"","description":"","author":"Oliver Chang","language":"zh-Hans","timezone":"","url":"http://blog.oliverch.com","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"pretty_urls":{"trailing_index":true},"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":{"enable":true,"field":"site","exclude":""},"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":false,"tab_replace":""},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","use_date_for_updated":false,"per_page":10,"pagination_dir":"page","theme":"melody","deploy":{"type":""},"ignore":null,"meta_generator":true,"keywords":null,"index_generator":{"per_page":10,"order_by":"-date","path":""},"include":null,"exclude":null,"archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"category_generator":{"per_page":10},"tag_generator":{"per_page":10},"marked":{"gfm":true,"pedantic":false,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true,"sanitizeUrl":false,"headerIds":true},"server":{"port":4000,"log":false,"compress":false,"header":true}}}}},"excerpt":"","more":""}],"Post":[{"title":"在 CentOS 7 下安装配置 GlusterFS","date":"2018-04-26T08:44:24.000Z","description":"在 CentOS 7 下 GlusterFS 搭建配置及使用。","_content":"\n# GLusterFS\n\nGlusterFS 是一个分布式文件系统，具有强大的横向扩展能力。主要提供的的存储功能为文件存储，当然也可通过其他方式支持快存储和对象存储。与存储相关的分布式文件系统还有 Ceph。\n\n\n\n## Enviroment\n\nOS: CentOS 7\n\n\n\n## Install GlusterFS\n\n```shell\n# yum -y install centos-release-gluster\n# yum install glusterfs-server\n```\n\n\n\n### Configure GlusterFS\n\n启动服务进程：\n\n```shell\n# systemctl enable glusterd.service\n# systemctl start glusterd.service\n```\n\n\n\nGLusterFS 节点之间通信用到了 TCP 端口 24007-24008，所以启用所需端口：\n\n```shell\n# firewall-cmd --zone=public --add-port=24007-24008/tcp --permanent\n# firewall-cmd --reload\n```\n\n或者选择关闭防火墙。\n\n\n\n## GlusterFS 管理\n\n这里简单介绍一下 GlusterFS 服务器端的管理程序 gluster 的使用。\n\n这里假设拥有 4 台服务器：\n\n| HOSTNAME | IP-address      |\n| -------- | --------------- |\n| node1    | xxx.xxx.xxx.xx1 |\n| node2    | xxx.xxx.xxx.xx2 |\n| node3    | xxx.xxx.xxx.xx3 |\n| node4    | xxx.xxx.xxx.xx4 |\n\n\n\n### Peer 操作\n\nGlusterFS 通过添加 Peer 来创建集群。\n\n\n\n#### Peer probe\n\n添加 Peer 需要指定该节点的 IP 或者 HOSTNAME。\n\n```shell\n$ gluster peer probe { <HOSTNAME> | <IP-address> }\n```\n\n例如在 node1 上：\n\n```shell\n$ gluster peer probe node2\n$ gluster peer probe node3\n$ gluster peer probe node4\n```\n\n这样就能将 node1、node2、node3 和 node4 四台服务器连接，组成一个服务器集群。\n\n\n\n#### Peer status\n\n查询集群中的节点信息：\n\n```shell\n$ gluster peer status\n```\n\n\n\n#### Peer detach\n\n移除 Peer 需要指定该节点的 IP 或者 HOSTNAME。\n\n```shell\n$ gluster peer detach { <HOSTNAME> | <IP-address> } [force] \n```\n\n\n\n例如在 node1 移除 node2：\n\n```shell\n$ gluster peer probe node2\n```\n\n不能在当前服务器从集群中移除当前服务器。\n\n\n\n### Volume 操作\n\nGLusterFS 通过创建 Volume 来创建一个虚拟存储池，通过 Volume 的不同类型来提供不同的存储功能。\n\n\n\n#### Volume create\n\n创建卷需要指定卷的名字，类型和 Brick（Brcik 是指服务器上的一个目录，后端实际存储的目录）。\n\n```shell\n$ gluster volume create <NEW-VOLNAME> [stripe <COUNT>] [replica <COUNT> [arbiter <COUNT>]] [disperse [<COUNT>]] [disperse-data <COUNT>] [redundancy <COUNT>] [transport <tcp|rdma|tcp,rdma>] <NEW-BRICK>?<vg_name>... [force]\n```\n\n不同类型的 Volume 对 Brick 的数量也有不同的要求。\n\n假设有如下 Brick：\n\n| HOSTNAME | Brick                 |\n| -------- | --------------------- |\n| node1    | node1:/bricks/brick01 |\n| node2    | node2:/bricks/brick01 |\n| node3    | node3:/bricks/brick01 |\n| node4    | node4:/bricks/brick01 |\n\n创建一个 replica 类型的 Volume，其 COUNT 至少为2 ,至少需要指定 2 个 Brick\n\n```shell\n$ gluster volume create voltest1 replica 2 node1:/bricks/brick01 node2:/bricks/brick01 node3::/bricks/brick01 node4:/bricks/brick01\n```\n\n该类型 volume 可以在存储文件的时候，在服务器保存一份该文件的副本。当然 GlusterFS 还有其他很多类型的 volume 这里就不一一介绍了。\n\n\n\n#### Volume info\n\n查看 Volume 的信息：\n\n```shell\n$ gluster volume info\n```\n\n\n\n#### Volume status\n\n查看 Volume 状态：\n\n```shell\n$ gluster volume status\n```\n\n\n\n#### Volume delete\n\n删除 Volume：\n\n```shell\n$ gluster volume delete <VOLNAME>\n```\n\n\n\n### Brick 操作\n\n在创建完 Volume 后，如果需要更大的空间，可以通过添加新的 Brick 来提高整体容量，同时添加 Brick 时不会停止服务。\n\n\n\n#### Brick add-bricks\n\n命令：\n\n```shell\n$ gluster volume add-brick <VOLNAME> [<stripe|replica> <COUNT> [arbiter <COUNT>]] <NEW-BRICK> ... [force]\n```\n\n\n\n一次添加 Brick 的数量要根据 Volume 的类型来决定。\n\n例如 `voltest1` 是 `replica 2` 则添加时需要添加 2 的整数倍的 Brick。\n\n要将 `node5/bricks/brick01`  `node6:/bricks/brick01`加入到 `voltest1`  Volume 中 \n\n```shell\n$ gluster volume add-brick voltest1 node5/bricks/brick01 node6:/bricks/brick01\n```\n\n\n\n#### Rebalance\n\n这时需要重新分配所保存文件的位置，这样可以确保每一个 Brick 都会被分配到文件，而不会过于集中在特定某一个 Brick。\n\n```shell\n$ gluster volume rebalance <VOLNAME> {{fix-layout start} | {start [force]|stop|status}}\n```\n\n\n\n查看 rebalance 状态\n\n```shell\n$ gluster volume rebalance voltest1 status\n```\n\n\n\n#### Brick 替换\n\n命令：\n\n```shell\n$ gluster volume replace-brick <VOLNAME> <SOURCE-BRICK> <NEW-BRICK> {commit force}\n```\n\n\n\n假设名称为 `voltest1` 的 Volume，使用 `node7:/bricks/brick01`替换 `node1:/bricks/birck01`\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node7:/bricks/brick01 start\n```\n\n\n\n这时可以查看替换的状态\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 status\n```\n\n\n\n最后 commit 确认移除旧的 Brick\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 commit\n```\n\n\n\n#### Brick 移除\n\n命令：\n\n```shell\n$ gluster volume remove-brick <VOLNAME> [replica <COUNT>] <BRICK> ... <start|stop|status|commit|force>\n```\n\n\n\n移除 Brick 的数量也是由 Volume 的类型决定，\n\n假设移除 `voltest1` 类型为 replica 2 的 Brick 那么移除的 Brick 数为 replica 的整数倍。\n\n```shell\n$ gluster volume remove-brick voltest1 node1:/bricks/brick01 node2:/bricks/brick01\n```\n\n\n\n### Snapshot 操作\n\nGluster 使用 LVM 的Snapshot 完成快照功能，也就是说您的 Brick 必须在 LVM 的环境中快照功能才能被使用。\n\n使用 LVM 上的 Brick 创建的 Volume 可以通过快照来实现数据的快速恢复。\n\n\n\n#### Snapshot create  \n\n命令：\n\n```shell\n$ gluster snapshot create <snapname> <volname> [no-timestamp] [description <description>] [force]\n```\n\n\n\n#### Snapshot activate\n\n在创建后需要激活才能使用：\n\n```shell\n$ gluster snapshot activate <snapname> [force]\n```\n\n\n\n#### Snapshot info\n\n查看快照信息：\n\n```shell\n$ gluster snapshot info\n```\n\n\n\n#### Snapshot restore\n\nGlusterFS 可以将 Volume 数据恢复到快照时的状态，但进行操作时必须停用 Volume，完成后重启。\n\n```shell\n$ gluster snapshot restore <snapname>\n```\n\n虽然这样不影响工作，但会照成 Brick 位置的变更，若非必要，不要直接使用Snapshot 还原整个Volume。\n\n\n\n#### Snapshot clone\n\nGlusterFS 提供从一个现有的快照，创建一个新的 Volume。\n\n```shell\n$ gluster snapshot clone <cloname> <snapname>\n```\n\n\n\n## GlusterFS Client\n\nGlusterFS 可以通过自己的客户端 Glusterfs 或者 Samba、NFS 来访问。\n\n\n\n### 开启防火墙\n\n为 Glusterfs、Samba 和 NFS 开启防火墙。\n\n```shell\n# firewall-cmd --zone=public --add-service=nfs --add-service=samba --add-service=samba-client --permanent\n\n# firewall-cmd --zone=public --add-port=111/tcp --add-port=139/tcp --add-port=445/tcp --add-port=965/tcp --add-port=2049/tcp \\\n--add-port=38465-38469/tcp --add-port=631/tcp --add-port=111/udp --add-port=963/udp --add-port=49152-49251/tcp  --permanent\n\n# firewall-cmd --reload\n```\n\n当然也可选择关闭防火墙。\n\n\n\n### Glusterfs client\n\n安装 GLusterfs client：\n\n```shell\n# yum install glusterfs glusterfs-fuse attr -y\n```\n\n\n\n挂载:\n\n```shell\n# mount -t glusterfs node1:/glustervol1 /mnt/\n```\n\nnode1 为一个服务器节点。\n\n\n\n### Samba \n\n安装：\n\n```shell\n# yum install samba samba-client samba-common samba-vfs-glusterfs selinux-policy-targeted -y\n```\n\n\n\n启动服务：\n\n```shell\n# systemctl start smb.service\n# systemctl enable smb.service\n# systemctl start nmb.service\n# systemctl enable nmb.service\n```\n\n\n\n在每个服务器端，修改 */etc/samba/smb.conf* 文件内的 GlusterFS 已创建 Volume 的配置：\n\n```ini\n[gluster-glustervol1]\ncomment = For samba share of volume glustervol1\nvfs objects = glusterfs\nglusterfs:volume = glustervol1\nglusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log\nglusterfs:loglevel = 7\npath = /\nread only = no\nguest ok = yes\n```\n\n在后面添加一行 **kernel share modes = No**。这个是为了解决挂载 samba 后创建文件后出现同时创建了多个文件的问题。具体原因不知道，如果有知道的可以交流一下。\n\n修改后为：\n\n```ini\n[gluster-glustervol1]\ncomment = For samba share of volume glustervol1\nvfs objects = glusterfs\nglusterfs:volume = glustervol1\nglusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log\nglusterfs:loglevel = 7\npath = /\nread only = no\nguest ok = yes\nkernel share modes = No\n```\n\n\n\n为了能够访问 Samba 需要创建用户，并设置密码。\n\n```shell\n# smbpasswd -a sambauser\n```\n\nsambauser 是一个用户名，按需要进行创建。\n\n\n\n设置 SELinux 运行 Samba 共享：\n\n```shell\n# setsebool -P samba_share_fusefs on\n# setsebool -P samba_load_libgfapi on\n```\n\n\n\n当然也可以选择关闭 SELinux\n\n编辑` /etc/sysconfig/selinux`\n\n将\n\n```ini\nSELINUX=enforcing\n```\n\n改为\n\n```ini\nSELINUX=disabled\n```\n\n\n\n挂载：\n\n```shell\n# mount -t cifs \\\\\\\\gluster1.example.com\\\\gluster-glustervol1 /mnt/ -o user=sambauser,pass=mypassword\n```\n\n在 Windows 下 可以通过在资源管理器里添加一个新的位置来链接 Samba 共享。\n\n\n\n### NFS\n\n需要开启 RPC 服务：\n\n```shell\n# systemctl enable rpcbind\n# systemctl start rpcbind\n```\n\n\n\n挂载：\n\n```shell\n# mount -t nfs gluster1.example.com:/glustervol1 /mnt/\n```\n\n\n\n\n\n## Block Storage\n\n块存储是非常常用的存储方式，GlusterFS 主要是文件存储，对于块存储要通过镜像文件的方式创建 iscsi target。\n\n这里推荐一个工具来创建帮助快速创建 [**gluster-block**](https://github.com/gluster/gluster-block.git) 。\n\n\n\n\n\n## 引用\n\n> CentOS Wiki: [gluster-Quickstart](https://wiki.centos.org/zh/SpecialInterestGroup/Storage/gluster-Quickstart?highlight=%28GlusterFS%29)  [GlusterFSonCentOS](https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS?highlight=%28GlusterFS%29)\n>\n> Gluster-Storage_GitBook: [http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/](http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/)\n>\n> \n\n","source":"_posts/hello-world.md","raw":"---\ntitle: 在 CentOS 7 下安装配置 GlusterFS \ntags: [\"Linux\",\"Centos\",\"GlusterFS\"]\ndate: 2018-04-26 16:44:24\ncategories: [\"GlusterFS\"]\ndescription: 在 CentOS 7 下 GlusterFS 搭建配置及使用。\n---\n\n# GLusterFS\n\nGlusterFS 是一个分布式文件系统，具有强大的横向扩展能力。主要提供的的存储功能为文件存储，当然也可通过其他方式支持快存储和对象存储。与存储相关的分布式文件系统还有 Ceph。\n\n\n\n## Enviroment\n\nOS: CentOS 7\n\n\n\n## Install GlusterFS\n\n```shell\n# yum -y install centos-release-gluster\n# yum install glusterfs-server\n```\n\n\n\n### Configure GlusterFS\n\n启动服务进程：\n\n```shell\n# systemctl enable glusterd.service\n# systemctl start glusterd.service\n```\n\n\n\nGLusterFS 节点之间通信用到了 TCP 端口 24007-24008，所以启用所需端口：\n\n```shell\n# firewall-cmd --zone=public --add-port=24007-24008/tcp --permanent\n# firewall-cmd --reload\n```\n\n或者选择关闭防火墙。\n\n\n\n## GlusterFS 管理\n\n这里简单介绍一下 GlusterFS 服务器端的管理程序 gluster 的使用。\n\n这里假设拥有 4 台服务器：\n\n| HOSTNAME | IP-address      |\n| -------- | --------------- |\n| node1    | xxx.xxx.xxx.xx1 |\n| node2    | xxx.xxx.xxx.xx2 |\n| node3    | xxx.xxx.xxx.xx3 |\n| node4    | xxx.xxx.xxx.xx4 |\n\n\n\n### Peer 操作\n\nGlusterFS 通过添加 Peer 来创建集群。\n\n\n\n#### Peer probe\n\n添加 Peer 需要指定该节点的 IP 或者 HOSTNAME。\n\n```shell\n$ gluster peer probe { <HOSTNAME> | <IP-address> }\n```\n\n例如在 node1 上：\n\n```shell\n$ gluster peer probe node2\n$ gluster peer probe node3\n$ gluster peer probe node4\n```\n\n这样就能将 node1、node2、node3 和 node4 四台服务器连接，组成一个服务器集群。\n\n\n\n#### Peer status\n\n查询集群中的节点信息：\n\n```shell\n$ gluster peer status\n```\n\n\n\n#### Peer detach\n\n移除 Peer 需要指定该节点的 IP 或者 HOSTNAME。\n\n```shell\n$ gluster peer detach { <HOSTNAME> | <IP-address> } [force] \n```\n\n\n\n例如在 node1 移除 node2：\n\n```shell\n$ gluster peer probe node2\n```\n\n不能在当前服务器从集群中移除当前服务器。\n\n\n\n### Volume 操作\n\nGLusterFS 通过创建 Volume 来创建一个虚拟存储池，通过 Volume 的不同类型来提供不同的存储功能。\n\n\n\n#### Volume create\n\n创建卷需要指定卷的名字，类型和 Brick（Brcik 是指服务器上的一个目录，后端实际存储的目录）。\n\n```shell\n$ gluster volume create <NEW-VOLNAME> [stripe <COUNT>] [replica <COUNT> [arbiter <COUNT>]] [disperse [<COUNT>]] [disperse-data <COUNT>] [redundancy <COUNT>] [transport <tcp|rdma|tcp,rdma>] <NEW-BRICK>?<vg_name>... [force]\n```\n\n不同类型的 Volume 对 Brick 的数量也有不同的要求。\n\n假设有如下 Brick：\n\n| HOSTNAME | Brick                 |\n| -------- | --------------------- |\n| node1    | node1:/bricks/brick01 |\n| node2    | node2:/bricks/brick01 |\n| node3    | node3:/bricks/brick01 |\n| node4    | node4:/bricks/brick01 |\n\n创建一个 replica 类型的 Volume，其 COUNT 至少为2 ,至少需要指定 2 个 Brick\n\n```shell\n$ gluster volume create voltest1 replica 2 node1:/bricks/brick01 node2:/bricks/brick01 node3::/bricks/brick01 node4:/bricks/brick01\n```\n\n该类型 volume 可以在存储文件的时候，在服务器保存一份该文件的副本。当然 GlusterFS 还有其他很多类型的 volume 这里就不一一介绍了。\n\n\n\n#### Volume info\n\n查看 Volume 的信息：\n\n```shell\n$ gluster volume info\n```\n\n\n\n#### Volume status\n\n查看 Volume 状态：\n\n```shell\n$ gluster volume status\n```\n\n\n\n#### Volume delete\n\n删除 Volume：\n\n```shell\n$ gluster volume delete <VOLNAME>\n```\n\n\n\n### Brick 操作\n\n在创建完 Volume 后，如果需要更大的空间，可以通过添加新的 Brick 来提高整体容量，同时添加 Brick 时不会停止服务。\n\n\n\n#### Brick add-bricks\n\n命令：\n\n```shell\n$ gluster volume add-brick <VOLNAME> [<stripe|replica> <COUNT> [arbiter <COUNT>]] <NEW-BRICK> ... [force]\n```\n\n\n\n一次添加 Brick 的数量要根据 Volume 的类型来决定。\n\n例如 `voltest1` 是 `replica 2` 则添加时需要添加 2 的整数倍的 Brick。\n\n要将 `node5/bricks/brick01`  `node6:/bricks/brick01`加入到 `voltest1`  Volume 中 \n\n```shell\n$ gluster volume add-brick voltest1 node5/bricks/brick01 node6:/bricks/brick01\n```\n\n\n\n#### Rebalance\n\n这时需要重新分配所保存文件的位置，这样可以确保每一个 Brick 都会被分配到文件，而不会过于集中在特定某一个 Brick。\n\n```shell\n$ gluster volume rebalance <VOLNAME> {{fix-layout start} | {start [force]|stop|status}}\n```\n\n\n\n查看 rebalance 状态\n\n```shell\n$ gluster volume rebalance voltest1 status\n```\n\n\n\n#### Brick 替换\n\n命令：\n\n```shell\n$ gluster volume replace-brick <VOLNAME> <SOURCE-BRICK> <NEW-BRICK> {commit force}\n```\n\n\n\n假设名称为 `voltest1` 的 Volume，使用 `node7:/bricks/brick01`替换 `node1:/bricks/birck01`\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node7:/bricks/brick01 start\n```\n\n\n\n这时可以查看替换的状态\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 status\n```\n\n\n\n最后 commit 确认移除旧的 Brick\n\n```shell\n$ gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 commit\n```\n\n\n\n#### Brick 移除\n\n命令：\n\n```shell\n$ gluster volume remove-brick <VOLNAME> [replica <COUNT>] <BRICK> ... <start|stop|status|commit|force>\n```\n\n\n\n移除 Brick 的数量也是由 Volume 的类型决定，\n\n假设移除 `voltest1` 类型为 replica 2 的 Brick 那么移除的 Brick 数为 replica 的整数倍。\n\n```shell\n$ gluster volume remove-brick voltest1 node1:/bricks/brick01 node2:/bricks/brick01\n```\n\n\n\n### Snapshot 操作\n\nGluster 使用 LVM 的Snapshot 完成快照功能，也就是说您的 Brick 必须在 LVM 的环境中快照功能才能被使用。\n\n使用 LVM 上的 Brick 创建的 Volume 可以通过快照来实现数据的快速恢复。\n\n\n\n#### Snapshot create  \n\n命令：\n\n```shell\n$ gluster snapshot create <snapname> <volname> [no-timestamp] [description <description>] [force]\n```\n\n\n\n#### Snapshot activate\n\n在创建后需要激活才能使用：\n\n```shell\n$ gluster snapshot activate <snapname> [force]\n```\n\n\n\n#### Snapshot info\n\n查看快照信息：\n\n```shell\n$ gluster snapshot info\n```\n\n\n\n#### Snapshot restore\n\nGlusterFS 可以将 Volume 数据恢复到快照时的状态，但进行操作时必须停用 Volume，完成后重启。\n\n```shell\n$ gluster snapshot restore <snapname>\n```\n\n虽然这样不影响工作，但会照成 Brick 位置的变更，若非必要，不要直接使用Snapshot 还原整个Volume。\n\n\n\n#### Snapshot clone\n\nGlusterFS 提供从一个现有的快照，创建一个新的 Volume。\n\n```shell\n$ gluster snapshot clone <cloname> <snapname>\n```\n\n\n\n## GlusterFS Client\n\nGlusterFS 可以通过自己的客户端 Glusterfs 或者 Samba、NFS 来访问。\n\n\n\n### 开启防火墙\n\n为 Glusterfs、Samba 和 NFS 开启防火墙。\n\n```shell\n# firewall-cmd --zone=public --add-service=nfs --add-service=samba --add-service=samba-client --permanent\n\n# firewall-cmd --zone=public --add-port=111/tcp --add-port=139/tcp --add-port=445/tcp --add-port=965/tcp --add-port=2049/tcp \\\n--add-port=38465-38469/tcp --add-port=631/tcp --add-port=111/udp --add-port=963/udp --add-port=49152-49251/tcp  --permanent\n\n# firewall-cmd --reload\n```\n\n当然也可选择关闭防火墙。\n\n\n\n### Glusterfs client\n\n安装 GLusterfs client：\n\n```shell\n# yum install glusterfs glusterfs-fuse attr -y\n```\n\n\n\n挂载:\n\n```shell\n# mount -t glusterfs node1:/glustervol1 /mnt/\n```\n\nnode1 为一个服务器节点。\n\n\n\n### Samba \n\n安装：\n\n```shell\n# yum install samba samba-client samba-common samba-vfs-glusterfs selinux-policy-targeted -y\n```\n\n\n\n启动服务：\n\n```shell\n# systemctl start smb.service\n# systemctl enable smb.service\n# systemctl start nmb.service\n# systemctl enable nmb.service\n```\n\n\n\n在每个服务器端，修改 */etc/samba/smb.conf* 文件内的 GlusterFS 已创建 Volume 的配置：\n\n```ini\n[gluster-glustervol1]\ncomment = For samba share of volume glustervol1\nvfs objects = glusterfs\nglusterfs:volume = glustervol1\nglusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log\nglusterfs:loglevel = 7\npath = /\nread only = no\nguest ok = yes\n```\n\n在后面添加一行 **kernel share modes = No**。这个是为了解决挂载 samba 后创建文件后出现同时创建了多个文件的问题。具体原因不知道，如果有知道的可以交流一下。\n\n修改后为：\n\n```ini\n[gluster-glustervol1]\ncomment = For samba share of volume glustervol1\nvfs objects = glusterfs\nglusterfs:volume = glustervol1\nglusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log\nglusterfs:loglevel = 7\npath = /\nread only = no\nguest ok = yes\nkernel share modes = No\n```\n\n\n\n为了能够访问 Samba 需要创建用户，并设置密码。\n\n```shell\n# smbpasswd -a sambauser\n```\n\nsambauser 是一个用户名，按需要进行创建。\n\n\n\n设置 SELinux 运行 Samba 共享：\n\n```shell\n# setsebool -P samba_share_fusefs on\n# setsebool -P samba_load_libgfapi on\n```\n\n\n\n当然也可以选择关闭 SELinux\n\n编辑` /etc/sysconfig/selinux`\n\n将\n\n```ini\nSELINUX=enforcing\n```\n\n改为\n\n```ini\nSELINUX=disabled\n```\n\n\n\n挂载：\n\n```shell\n# mount -t cifs \\\\\\\\gluster1.example.com\\\\gluster-glustervol1 /mnt/ -o user=sambauser,pass=mypassword\n```\n\n在 Windows 下 可以通过在资源管理器里添加一个新的位置来链接 Samba 共享。\n\n\n\n### NFS\n\n需要开启 RPC 服务：\n\n```shell\n# systemctl enable rpcbind\n# systemctl start rpcbind\n```\n\n\n\n挂载：\n\n```shell\n# mount -t nfs gluster1.example.com:/glustervol1 /mnt/\n```\n\n\n\n\n\n## Block Storage\n\n块存储是非常常用的存储方式，GlusterFS 主要是文件存储，对于块存储要通过镜像文件的方式创建 iscsi target。\n\n这里推荐一个工具来创建帮助快速创建 [**gluster-block**](https://github.com/gluster/gluster-block.git) 。\n\n\n\n\n\n## 引用\n\n> CentOS Wiki: [gluster-Quickstart](https://wiki.centos.org/zh/SpecialInterestGroup/Storage/gluster-Quickstart?highlight=%28GlusterFS%29)  [GlusterFSonCentOS](https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS?highlight=%28GlusterFS%29)\n>\n> Gluster-Storage_GitBook: [http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/](http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/)\n>\n> \n\n","slug":"hello-world","published":1,"updated":"2019-11-03T07:05:48.106Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck2iw6j9t0000vuqp697s6hwj","content":"<h1 id=\"GLusterFS\"><a href=\"#GLusterFS\" class=\"headerlink\" title=\"GLusterFS\"></a>GLusterFS</h1><p>GlusterFS 是一个分布式文件系统，具有强大的横向扩展能力。主要提供的的存储功能为文件存储，当然也可通过其他方式支持快存储和对象存储。与存储相关的分布式文件系统还有 Ceph。</p>\n<h2 id=\"Enviroment\"><a href=\"#Enviroment\" class=\"headerlink\" title=\"Enviroment\"></a>Enviroment</h2><p>OS: CentOS 7</p>\n<h2 id=\"Install-GlusterFS\"><a href=\"#Install-GlusterFS\" class=\"headerlink\" title=\"Install GlusterFS\"></a>Install GlusterFS</h2><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum -y install centos-release-gluster</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install glusterfs-server</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Configure-GlusterFS\"><a href=\"#Configure-GlusterFS\" class=\"headerlink\" title=\"Configure GlusterFS\"></a>Configure GlusterFS</h3><p>启动服务进程：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> glusterd.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start glusterd.service</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>GLusterFS 节点之间通信用到了 TCP 端口 24007-24008，所以启用所需端口：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-port=24007-24008/tcp --permanent</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>\n\n<p>或者选择关闭防火墙。</p>\n<h2 id=\"GlusterFS-管理\"><a href=\"#GlusterFS-管理\" class=\"headerlink\" title=\"GlusterFS 管理\"></a>GlusterFS 管理</h2><p>这里简单介绍一下 GlusterFS 服务器端的管理程序 gluster 的使用。</p>\n<p>这里假设拥有 4 台服务器：</p>\n<table>\n<thead>\n<tr>\n<th>HOSTNAME</th>\n<th>IP-address</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>node1</td>\n<td>xxx.xxx.xxx.xx1</td>\n</tr>\n<tr>\n<td>node2</td>\n<td>xxx.xxx.xxx.xx2</td>\n</tr>\n<tr>\n<td>node3</td>\n<td>xxx.xxx.xxx.xx3</td>\n</tr>\n<tr>\n<td>node4</td>\n<td>xxx.xxx.xxx.xx4</td>\n</tr>\n</tbody></table>\n<h3 id=\"Peer-操作\"><a href=\"#Peer-操作\" class=\"headerlink\" title=\"Peer 操作\"></a>Peer 操作</h3><p>GlusterFS 通过添加 Peer 来创建集群。</p>\n<h4 id=\"Peer-probe\"><a href=\"#Peer-probe\" class=\"headerlink\" title=\"Peer probe\"></a>Peer probe</h4><p>添加 Peer 需要指定该节点的 IP 或者 HOSTNAME。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe &#123; &lt;HOSTNAME&gt; | &lt;IP-address&gt; &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>例如在 node1 上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node2</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node3</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node4</span></span><br></pre></td></tr></table></figure>\n\n<p>这样就能将 node1、node2、node3 和 node4 四台服务器连接，组成一个服务器集群。</p>\n<h4 id=\"Peer-status\"><a href=\"#Peer-status\" class=\"headerlink\" title=\"Peer status\"></a>Peer status</h4><p>查询集群中的节点信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Peer-detach\"><a href=\"#Peer-detach\" class=\"headerlink\" title=\"Peer detach\"></a>Peer detach</h4><p>移除 Peer 需要指定该节点的 IP 或者 HOSTNAME。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer detach &#123; &lt;HOSTNAME&gt; | &lt;IP-address&gt; &#125; [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>例如在 node1 移除 node2：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node2</span></span><br></pre></td></tr></table></figure>\n\n<p>不能在当前服务器从集群中移除当前服务器。</p>\n<h3 id=\"Volume-操作\"><a href=\"#Volume-操作\" class=\"headerlink\" title=\"Volume 操作\"></a>Volume 操作</h3><p>GLusterFS 通过创建 Volume 来创建一个虚拟存储池，通过 Volume 的不同类型来提供不同的存储功能。</p>\n<h4 id=\"Volume-create\"><a href=\"#Volume-create\" class=\"headerlink\" title=\"Volume create\"></a>Volume create</h4><p>创建卷需要指定卷的名字，类型和 Brick（Brcik 是指服务器上的一个目录，后端实际存储的目录）。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume create &lt;NEW-VOLNAME&gt; [stripe &lt;COUNT&gt;] [replica &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]] [disperse [&lt;COUNT&gt;]] [disperse-data &lt;COUNT&gt;] [redundancy &lt;COUNT&gt;] [transport &lt;tcp|rdma|tcp,rdma&gt;] &lt;NEW-BRICK&gt;?&lt;vg_name&gt;... [force]</span></span><br></pre></td></tr></table></figure>\n\n<p>不同类型的 Volume 对 Brick 的数量也有不同的要求。</p>\n<p>假设有如下 Brick：</p>\n<table>\n<thead>\n<tr>\n<th>HOSTNAME</th>\n<th>Brick</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>node1</td>\n<td>node1:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node2</td>\n<td>node2:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node3</td>\n<td>node3:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node4</td>\n<td>node4:/bricks/brick01</td>\n</tr>\n</tbody></table>\n<p>创建一个 replica 类型的 Volume，其 COUNT 至少为2 ,至少需要指定 2 个 Brick</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume create voltest1 replica 2 node1:/bricks/brick01 node2:/bricks/brick01 node3::/bricks/brick01 node4:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n<p>该类型 volume 可以在存储文件的时候，在服务器保存一份该文件的副本。当然 GlusterFS 还有其他很多类型的 volume 这里就不一一介绍了。</p>\n<h4 id=\"Volume-info\"><a href=\"#Volume-info\" class=\"headerlink\" title=\"Volume info\"></a>Volume info</h4><p>查看 Volume 的信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume info</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Volume-status\"><a href=\"#Volume-status\" class=\"headerlink\" title=\"Volume status\"></a>Volume status</h4><p>查看 Volume 状态：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Volume-delete\"><a href=\"#Volume-delete\" class=\"headerlink\" title=\"Volume delete\"></a>Volume delete</h4><p>删除 Volume：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume delete &lt;VOLNAME&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Brick-操作\"><a href=\"#Brick-操作\" class=\"headerlink\" title=\"Brick 操作\"></a>Brick 操作</h3><p>在创建完 Volume 后，如果需要更大的空间，可以通过添加新的 Brick 来提高整体容量，同时添加 Brick 时不会停止服务。</p>\n<h4 id=\"Brick-add-bricks\"><a href=\"#Brick-add-bricks\" class=\"headerlink\" title=\"Brick add-bricks\"></a>Brick add-bricks</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume add-brick &lt;VOLNAME&gt; [&lt;stripe|replica&gt; &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]] &lt;NEW-BRICK&gt; ... [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>一次添加 Brick 的数量要根据 Volume 的类型来决定。</p>\n<p>例如 <code>voltest1</code> 是 <code>replica 2</code> 则添加时需要添加 2 的整数倍的 Brick。</p>\n<p>要将 <code>node5/bricks/brick01</code>  <code>node6:/bricks/brick01</code>加入到 <code>voltest1</code>  Volume 中 </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume add-brick voltest1 node5/bricks/brick01 node6:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Rebalance\"><a href=\"#Rebalance\" class=\"headerlink\" title=\"Rebalance\"></a>Rebalance</h4><p>这时需要重新分配所保存文件的位置，这样可以确保每一个 Brick 都会被分配到文件，而不会过于集中在特定某一个 Brick。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume rebalance &lt;VOLNAME&gt; &#123;&#123;fix-layout start&#125; | &#123;start [force]|stop|status&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>查看 rebalance 状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume rebalance voltest1 status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Brick-替换\"><a href=\"#Brick-替换\" class=\"headerlink\" title=\"Brick 替换\"></a>Brick 替换</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick &lt;VOLNAME&gt; &lt;SOURCE-BRICK&gt; &lt;NEW-BRICK&gt; &#123;commit force&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>假设名称为 <code>voltest1</code> 的 Volume，使用 <code>node7:/bricks/brick01</code>替换 <code>node1:/bricks/birck01</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node7:/bricks/brick01 start</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>这时可以查看替换的状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>最后 commit 确认移除旧的 Brick</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 commit</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Brick-移除\"><a href=\"#Brick-移除\" class=\"headerlink\" title=\"Brick 移除\"></a>Brick 移除</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume remove-brick &lt;VOLNAME&gt; [replica &lt;COUNT&gt;] &lt;BRICK&gt; ... &lt;start|stop|status|commit|force&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>移除 Brick 的数量也是由 Volume 的类型决定，</p>\n<p>假设移除 <code>voltest1</code> 类型为 replica 2 的 Brick 那么移除的 Brick 数为 replica 的整数倍。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume remove-brick voltest1 node1:/bricks/brick01 node2:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Snapshot-操作\"><a href=\"#Snapshot-操作\" class=\"headerlink\" title=\"Snapshot 操作\"></a>Snapshot 操作</h3><p>Gluster 使用 LVM 的Snapshot 完成快照功能，也就是说您的 Brick 必须在 LVM 的环境中快照功能才能被使用。</p>\n<p>使用 LVM 上的 Brick 创建的 Volume 可以通过快照来实现数据的快速恢复。</p>\n<h4 id=\"Snapshot-create\"><a href=\"#Snapshot-create\" class=\"headerlink\" title=\"Snapshot create\"></a>Snapshot create</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot create &lt;snapname&gt; &lt;volname&gt; [no-timestamp] [description &lt;description&gt;] [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-activate\"><a href=\"#Snapshot-activate\" class=\"headerlink\" title=\"Snapshot activate\"></a>Snapshot activate</h4><p>在创建后需要激活才能使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot activate &lt;snapname&gt; [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-info\"><a href=\"#Snapshot-info\" class=\"headerlink\" title=\"Snapshot info\"></a>Snapshot info</h4><p>查看快照信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot info</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-restore\"><a href=\"#Snapshot-restore\" class=\"headerlink\" title=\"Snapshot restore\"></a>Snapshot restore</h4><p>GlusterFS 可以将 Volume 数据恢复到快照时的状态，但进行操作时必须停用 Volume，完成后重启。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot restore &lt;snapname&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>虽然这样不影响工作，但会照成 Brick 位置的变更，若非必要，不要直接使用Snapshot 还原整个Volume。</p>\n<h4 id=\"Snapshot-clone\"><a href=\"#Snapshot-clone\" class=\"headerlink\" title=\"Snapshot clone\"></a>Snapshot clone</h4><p>GlusterFS 提供从一个现有的快照，创建一个新的 Volume。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot <span class=\"built_in\">clone</span> &lt;cloname&gt; &lt;snapname&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"GlusterFS-Client\"><a href=\"#GlusterFS-Client\" class=\"headerlink\" title=\"GlusterFS Client\"></a>GlusterFS Client</h2><p>GlusterFS 可以通过自己的客户端 Glusterfs 或者 Samba、NFS 来访问。</p>\n<h3 id=\"开启防火墙\"><a href=\"#开启防火墙\" class=\"headerlink\" title=\"开启防火墙\"></a>开启防火墙</h3><p>为 Glusterfs、Samba 和 NFS 开启防火墙。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-service=nfs --add-service=samba --add-service=samba-client --permanent</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-port=111/tcp --add-port=139/tcp --add-port=445/tcp --add-port=965/tcp --add-port=2049/tcp \\</span></span><br><span class=\"line\">--add-port=38465-38469/tcp --add-port=631/tcp --add-port=111/udp --add-port=963/udp --add-port=49152-49251/tcp  --permanent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>\n\n<p>当然也可选择关闭防火墙。</p>\n<h3 id=\"Glusterfs-client\"><a href=\"#Glusterfs-client\" class=\"headerlink\" title=\"Glusterfs client\"></a>Glusterfs client</h3><p>安装 GLusterfs client：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install glusterfs glusterfs-fuse attr -y</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t glusterfs node1:/glustervol1 /mnt/</span></span><br></pre></td></tr></table></figure>\n\n<p>node1 为一个服务器节点。</p>\n<h3 id=\"Samba\"><a href=\"#Samba\" class=\"headerlink\" title=\"Samba\"></a>Samba</h3><p>安装：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install samba samba-client samba-common samba-vfs-glusterfs selinux-policy-targeted -y</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start smb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> smb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start nmb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> nmb.service</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>在每个服务器端，修改 <em>/etc/samba/smb.conf</em> 文件内的 GlusterFS 已创建 Volume 的配置：</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[gluster-glustervol1]</span></span><br><span class=\"line\"><span class=\"attr\">comment</span> = For samba share of volume glustervol1</span><br><span class=\"line\">vfs objects = glusterfs</span><br><span class=\"line\">glusterfs:volume = glustervol1</span><br><span class=\"line\">glusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log</span><br><span class=\"line\">glusterfs:loglevel = 7</span><br><span class=\"line\"><span class=\"attr\">path</span> = /</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">guest ok = yes</span><br></pre></td></tr></table></figure>\n\n<p>在后面添加一行 <strong>kernel share modes = No</strong>。这个是为了解决挂载 samba 后创建文件后出现同时创建了多个文件的问题。具体原因不知道，如果有知道的可以交流一下。</p>\n<p>修改后为：</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[gluster-glustervol1]</span></span><br><span class=\"line\"><span class=\"attr\">comment</span> = For samba share of volume glustervol1</span><br><span class=\"line\">vfs objects = glusterfs</span><br><span class=\"line\">glusterfs:volume = glustervol1</span><br><span class=\"line\">glusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log</span><br><span class=\"line\">glusterfs:loglevel = 7</span><br><span class=\"line\"><span class=\"attr\">path</span> = /</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">guest ok = yes</span><br><span class=\"line\">kernel share modes = No</span><br></pre></td></tr></table></figure>\n\n\n\n<p>为了能够访问 Samba 需要创建用户，并设置密码。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> smbpasswd -a sambauser</span></span><br></pre></td></tr></table></figure>\n\n<p>sambauser 是一个用户名，按需要进行创建。</p>\n<p>设置 SELinux 运行 Samba 共享：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> setsebool -P samba_share_fusefs on</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> setsebool -P samba_load_libgfapi on</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>当然也可以选择关闭 SELinux</p>\n<p>编辑<code>/etc/sysconfig/selinux</code></p>\n<p>将</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">SELINUX</span>=enforcing</span><br></pre></td></tr></table></figure>\n\n<p>改为</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t cifs \\\\\\\\gluster1.example.com\\\\gluster-glustervol1 /mnt/ -o user=sambauser,pass=mypassword</span></span><br></pre></td></tr></table></figure>\n\n<p>在 Windows 下 可以通过在资源管理器里添加一个新的位置来链接 Samba 共享。</p>\n<h3 id=\"NFS\"><a href=\"#NFS\" class=\"headerlink\" title=\"NFS\"></a>NFS</h3><p>需要开启 RPC 服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> rpcbind</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start rpcbind</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t nfs gluster1.example.com:/glustervol1 /mnt/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"Block-Storage\"><a href=\"#Block-Storage\" class=\"headerlink\" title=\"Block Storage\"></a>Block Storage</h2><p>块存储是非常常用的存储方式，GlusterFS 主要是文件存储，对于块存储要通过镜像文件的方式创建 iscsi target。</p>\n<p>这里推荐一个工具来创建帮助快速创建 <a href=\"https://github.com/gluster/gluster-block.git\" target=\"_blank\" rel=\"noopener\"><strong>gluster-block</strong></a> 。</p>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><blockquote>\n<p>CentOS Wiki: <a href=\"https://wiki.centos.org/zh/SpecialInterestGroup/Storage/gluster-Quickstart?highlight=%28GlusterFS%29\" target=\"_blank\" rel=\"noopener\">gluster-Quickstart</a>  <a href=\"https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS?highlight=%28GlusterFS%29\" target=\"_blank\" rel=\"noopener\">GlusterFSonCentOS</a></p>\n<p>Gluster-Storage_GitBook: <a href=\"http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/\" target=\"_blank\" rel=\"noopener\">http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/</a></p>\n</blockquote>\n","site":{"data":{"melody":{"menu":{"Home":"/","Archives":"/archives","Tags":"/tags","Categories":"/categories"},"favicon":"/melody-favicon.ico","pwa":{"enable":false,"manifest":"/manifest.json"},"highlight_theme":"default","code_word_wrap":true,"social":{"github fa":"https://github.com/Oliver-Chang"},"algolia_search":{"enable":false,"hits":{"per_page":10}},"local_search":{"enable":false},"mathjax":{"enable":false,"cdn":"https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"enable":false,"cdn":{"css":"https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"},"hide_scrollbar":true},"fireworks":true,"baidu_analytics":null,"google_analytics":null,"tencent_analytics":null,"stylesheets":["/css/index.css"],"scripts":["/js/utils.js","/js/fancybox.js","/js/sidebar.js","/js/copy.js","/js/fireworks.js","/js/transition.js","/js/scroll.js","/js/head.js"],"cdn":{"css":{"fontawesome":"https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"},"js":{"anime":"https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js","jquery":"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js","fancybox":"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js","velocity":"https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js","velocity-ui":"https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"}},"avatar":null,"top_img":true,"top_img_height":60,"post_meta":{"date_type":"created","categories":true,"tags":true},"wordcount":{"enable":false},"toc":{"enable":true},"post_copyright":{"enable":true,"license":"CC BY-NC-SA 4.0","license_url":"https://creativecommons.org/licenses/by-nc-sa/4.0/"},"auto_excerpt":{"enable":true,"length":150},"slide":{"separator":"---","separator_vertical":"--","charset":"utf-8","theme":"black","mouseWheel":false,"transition":"slide","transitionSpeed":"default","parallaxBackgroundImage":"","parallaxBackgroundSize":"","parallaxBackgroundHorizontal":null,"parallaxBackgroundVertical":null},"addThis":{"enable":false},"disqus":{"enable":false},"since":2013,"ICP":{"enable":false},"busuanzi":{"enable":true,"site_uv":true,"site_uv_header":"<i class=\"fa fa-user\"></i>","site_uv_footer":null,"site_pv":true,"site_pv_header":"<i class=\"fa fa-eye\"></i>","site_pv_footer":null,"page_pv":true,"page_pv_header":"<i class=\"fa fa-file\"></i>","page_pv_footer":null},"canvas_ribbon":{"enable":false,"size":150,"alpha":0.6,"zIndex":-1,"click_to_change":false},"sidebar_display":"post","google_adsense":{"enable":false,"js":"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js","client":"ca-pub-...........","enable_page_level_ads":true},"google_site_verification":null,"bing_site_verification":null,"baidu_site_verification":null,"qihu_site_verification":null,"disable_baidu_transformation":true,"404Text":null,"rootConfig":{"title":"env.Title","subtitle":"","description":"","author":"Oliver Chang","language":"zh-Hans","timezone":"","url":"http://blog.oliverch.com","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"pretty_urls":{"trailing_index":true},"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":{"enable":true,"field":"site","exclude":""},"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":false,"tab_replace":""},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","use_date_for_updated":false,"per_page":10,"pagination_dir":"page","theme":"melody","deploy":{"type":""},"ignore":null,"meta_generator":true,"keywords":null,"index_generator":{"per_page":10,"order_by":"-date","path":""},"include":null,"exclude":null,"archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"category_generator":{"per_page":10},"tag_generator":{"per_page":10},"marked":{"gfm":true,"pedantic":false,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true,"sanitizeUrl":false,"headerIds":true},"server":{"port":4000,"log":false,"compress":false,"header":true}}}}},"excerpt":"","more":"<h1 id=\"GLusterFS\"><a href=\"#GLusterFS\" class=\"headerlink\" title=\"GLusterFS\"></a>GLusterFS</h1><p>GlusterFS 是一个分布式文件系统，具有强大的横向扩展能力。主要提供的的存储功能为文件存储，当然也可通过其他方式支持快存储和对象存储。与存储相关的分布式文件系统还有 Ceph。</p>\n<h2 id=\"Enviroment\"><a href=\"#Enviroment\" class=\"headerlink\" title=\"Enviroment\"></a>Enviroment</h2><p>OS: CentOS 7</p>\n<h2 id=\"Install-GlusterFS\"><a href=\"#Install-GlusterFS\" class=\"headerlink\" title=\"Install GlusterFS\"></a>Install GlusterFS</h2><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum -y install centos-release-gluster</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install glusterfs-server</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Configure-GlusterFS\"><a href=\"#Configure-GlusterFS\" class=\"headerlink\" title=\"Configure GlusterFS\"></a>Configure GlusterFS</h3><p>启动服务进程：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> glusterd.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start glusterd.service</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>GLusterFS 节点之间通信用到了 TCP 端口 24007-24008，所以启用所需端口：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-port=24007-24008/tcp --permanent</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>\n\n<p>或者选择关闭防火墙。</p>\n<h2 id=\"GlusterFS-管理\"><a href=\"#GlusterFS-管理\" class=\"headerlink\" title=\"GlusterFS 管理\"></a>GlusterFS 管理</h2><p>这里简单介绍一下 GlusterFS 服务器端的管理程序 gluster 的使用。</p>\n<p>这里假设拥有 4 台服务器：</p>\n<table>\n<thead>\n<tr>\n<th>HOSTNAME</th>\n<th>IP-address</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>node1</td>\n<td>xxx.xxx.xxx.xx1</td>\n</tr>\n<tr>\n<td>node2</td>\n<td>xxx.xxx.xxx.xx2</td>\n</tr>\n<tr>\n<td>node3</td>\n<td>xxx.xxx.xxx.xx3</td>\n</tr>\n<tr>\n<td>node4</td>\n<td>xxx.xxx.xxx.xx4</td>\n</tr>\n</tbody></table>\n<h3 id=\"Peer-操作\"><a href=\"#Peer-操作\" class=\"headerlink\" title=\"Peer 操作\"></a>Peer 操作</h3><p>GlusterFS 通过添加 Peer 来创建集群。</p>\n<h4 id=\"Peer-probe\"><a href=\"#Peer-probe\" class=\"headerlink\" title=\"Peer probe\"></a>Peer probe</h4><p>添加 Peer 需要指定该节点的 IP 或者 HOSTNAME。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe &#123; &lt;HOSTNAME&gt; | &lt;IP-address&gt; &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>例如在 node1 上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node2</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node3</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node4</span></span><br></pre></td></tr></table></figure>\n\n<p>这样就能将 node1、node2、node3 和 node4 四台服务器连接，组成一个服务器集群。</p>\n<h4 id=\"Peer-status\"><a href=\"#Peer-status\" class=\"headerlink\" title=\"Peer status\"></a>Peer status</h4><p>查询集群中的节点信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Peer-detach\"><a href=\"#Peer-detach\" class=\"headerlink\" title=\"Peer detach\"></a>Peer detach</h4><p>移除 Peer 需要指定该节点的 IP 或者 HOSTNAME。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer detach &#123; &lt;HOSTNAME&gt; | &lt;IP-address&gt; &#125; [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>例如在 node1 移除 node2：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster peer probe node2</span></span><br></pre></td></tr></table></figure>\n\n<p>不能在当前服务器从集群中移除当前服务器。</p>\n<h3 id=\"Volume-操作\"><a href=\"#Volume-操作\" class=\"headerlink\" title=\"Volume 操作\"></a>Volume 操作</h3><p>GLusterFS 通过创建 Volume 来创建一个虚拟存储池，通过 Volume 的不同类型来提供不同的存储功能。</p>\n<h4 id=\"Volume-create\"><a href=\"#Volume-create\" class=\"headerlink\" title=\"Volume create\"></a>Volume create</h4><p>创建卷需要指定卷的名字，类型和 Brick（Brcik 是指服务器上的一个目录，后端实际存储的目录）。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume create &lt;NEW-VOLNAME&gt; [stripe &lt;COUNT&gt;] [replica &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]] [disperse [&lt;COUNT&gt;]] [disperse-data &lt;COUNT&gt;] [redundancy &lt;COUNT&gt;] [transport &lt;tcp|rdma|tcp,rdma&gt;] &lt;NEW-BRICK&gt;?&lt;vg_name&gt;... [force]</span></span><br></pre></td></tr></table></figure>\n\n<p>不同类型的 Volume 对 Brick 的数量也有不同的要求。</p>\n<p>假设有如下 Brick：</p>\n<table>\n<thead>\n<tr>\n<th>HOSTNAME</th>\n<th>Brick</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>node1</td>\n<td>node1:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node2</td>\n<td>node2:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node3</td>\n<td>node3:/bricks/brick01</td>\n</tr>\n<tr>\n<td>node4</td>\n<td>node4:/bricks/brick01</td>\n</tr>\n</tbody></table>\n<p>创建一个 replica 类型的 Volume，其 COUNT 至少为2 ,至少需要指定 2 个 Brick</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume create voltest1 replica 2 node1:/bricks/brick01 node2:/bricks/brick01 node3::/bricks/brick01 node4:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n<p>该类型 volume 可以在存储文件的时候，在服务器保存一份该文件的副本。当然 GlusterFS 还有其他很多类型的 volume 这里就不一一介绍了。</p>\n<h4 id=\"Volume-info\"><a href=\"#Volume-info\" class=\"headerlink\" title=\"Volume info\"></a>Volume info</h4><p>查看 Volume 的信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume info</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Volume-status\"><a href=\"#Volume-status\" class=\"headerlink\" title=\"Volume status\"></a>Volume status</h4><p>查看 Volume 状态：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Volume-delete\"><a href=\"#Volume-delete\" class=\"headerlink\" title=\"Volume delete\"></a>Volume delete</h4><p>删除 Volume：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume delete &lt;VOLNAME&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Brick-操作\"><a href=\"#Brick-操作\" class=\"headerlink\" title=\"Brick 操作\"></a>Brick 操作</h3><p>在创建完 Volume 后，如果需要更大的空间，可以通过添加新的 Brick 来提高整体容量，同时添加 Brick 时不会停止服务。</p>\n<h4 id=\"Brick-add-bricks\"><a href=\"#Brick-add-bricks\" class=\"headerlink\" title=\"Brick add-bricks\"></a>Brick add-bricks</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume add-brick &lt;VOLNAME&gt; [&lt;stripe|replica&gt; &lt;COUNT&gt; [arbiter &lt;COUNT&gt;]] &lt;NEW-BRICK&gt; ... [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>一次添加 Brick 的数量要根据 Volume 的类型来决定。</p>\n<p>例如 <code>voltest1</code> 是 <code>replica 2</code> 则添加时需要添加 2 的整数倍的 Brick。</p>\n<p>要将 <code>node5/bricks/brick01</code>  <code>node6:/bricks/brick01</code>加入到 <code>voltest1</code>  Volume 中 </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume add-brick voltest1 node5/bricks/brick01 node6:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Rebalance\"><a href=\"#Rebalance\" class=\"headerlink\" title=\"Rebalance\"></a>Rebalance</h4><p>这时需要重新分配所保存文件的位置，这样可以确保每一个 Brick 都会被分配到文件，而不会过于集中在特定某一个 Brick。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume rebalance &lt;VOLNAME&gt; &#123;&#123;fix-layout start&#125; | &#123;start [force]|stop|status&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>查看 rebalance 状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume rebalance voltest1 status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Brick-替换\"><a href=\"#Brick-替换\" class=\"headerlink\" title=\"Brick 替换\"></a>Brick 替换</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick &lt;VOLNAME&gt; &lt;SOURCE-BRICK&gt; &lt;NEW-BRICK&gt; &#123;commit force&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>假设名称为 <code>voltest1</code> 的 Volume，使用 <code>node7:/bricks/brick01</code>替换 <code>node1:/bricks/birck01</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node7:/bricks/brick01 start</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>这时可以查看替换的状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 status</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>最后 commit 确认移除旧的 Brick</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume replace-brick voltest1 node1:/bricks/brick01 node5:/bricks/brick01 commit</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Brick-移除\"><a href=\"#Brick-移除\" class=\"headerlink\" title=\"Brick 移除\"></a>Brick 移除</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume remove-brick &lt;VOLNAME&gt; [replica &lt;COUNT&gt;] &lt;BRICK&gt; ... &lt;start|stop|status|commit|force&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>移除 Brick 的数量也是由 Volume 的类型决定，</p>\n<p>假设移除 <code>voltest1</code> 类型为 replica 2 的 Brick 那么移除的 Brick 数为 replica 的整数倍。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster volume remove-brick voltest1 node1:/bricks/brick01 node2:/bricks/brick01</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Snapshot-操作\"><a href=\"#Snapshot-操作\" class=\"headerlink\" title=\"Snapshot 操作\"></a>Snapshot 操作</h3><p>Gluster 使用 LVM 的Snapshot 完成快照功能，也就是说您的 Brick 必须在 LVM 的环境中快照功能才能被使用。</p>\n<p>使用 LVM 上的 Brick 创建的 Volume 可以通过快照来实现数据的快速恢复。</p>\n<h4 id=\"Snapshot-create\"><a href=\"#Snapshot-create\" class=\"headerlink\" title=\"Snapshot create\"></a>Snapshot create</h4><p>命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot create &lt;snapname&gt; &lt;volname&gt; [no-timestamp] [description &lt;description&gt;] [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-activate\"><a href=\"#Snapshot-activate\" class=\"headerlink\" title=\"Snapshot activate\"></a>Snapshot activate</h4><p>在创建后需要激活才能使用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot activate &lt;snapname&gt; [force]</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-info\"><a href=\"#Snapshot-info\" class=\"headerlink\" title=\"Snapshot info\"></a>Snapshot info</h4><p>查看快照信息：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot info</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"Snapshot-restore\"><a href=\"#Snapshot-restore\" class=\"headerlink\" title=\"Snapshot restore\"></a>Snapshot restore</h4><p>GlusterFS 可以将 Volume 数据恢复到快照时的状态，但进行操作时必须停用 Volume，完成后重启。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot restore &lt;snapname&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>虽然这样不影响工作，但会照成 Brick 位置的变更，若非必要，不要直接使用Snapshot 还原整个Volume。</p>\n<h4 id=\"Snapshot-clone\"><a href=\"#Snapshot-clone\" class=\"headerlink\" title=\"Snapshot clone\"></a>Snapshot clone</h4><p>GlusterFS 提供从一个现有的快照，创建一个新的 Volume。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> gluster snapshot <span class=\"built_in\">clone</span> &lt;cloname&gt; &lt;snapname&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"GlusterFS-Client\"><a href=\"#GlusterFS-Client\" class=\"headerlink\" title=\"GlusterFS Client\"></a>GlusterFS Client</h2><p>GlusterFS 可以通过自己的客户端 Glusterfs 或者 Samba、NFS 来访问。</p>\n<h3 id=\"开启防火墙\"><a href=\"#开启防火墙\" class=\"headerlink\" title=\"开启防火墙\"></a>开启防火墙</h3><p>为 Glusterfs、Samba 和 NFS 开启防火墙。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-service=nfs --add-service=samba --add-service=samba-client --permanent</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --zone=public --add-port=111/tcp --add-port=139/tcp --add-port=445/tcp --add-port=965/tcp --add-port=2049/tcp \\</span></span><br><span class=\"line\">--add-port=38465-38469/tcp --add-port=631/tcp --add-port=111/udp --add-port=963/udp --add-port=49152-49251/tcp  --permanent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> firewall-cmd --reload</span></span><br></pre></td></tr></table></figure>\n\n<p>当然也可选择关闭防火墙。</p>\n<h3 id=\"Glusterfs-client\"><a href=\"#Glusterfs-client\" class=\"headerlink\" title=\"Glusterfs client\"></a>Glusterfs client</h3><p>安装 GLusterfs client：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install glusterfs glusterfs-fuse attr -y</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t glusterfs node1:/glustervol1 /mnt/</span></span><br></pre></td></tr></table></figure>\n\n<p>node1 为一个服务器节点。</p>\n<h3 id=\"Samba\"><a href=\"#Samba\" class=\"headerlink\" title=\"Samba\"></a>Samba</h3><p>安装：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> yum install samba samba-client samba-common samba-vfs-glusterfs selinux-policy-targeted -y</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>启动服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start smb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> smb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start nmb.service</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> nmb.service</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>在每个服务器端，修改 <em>/etc/samba/smb.conf</em> 文件内的 GlusterFS 已创建 Volume 的配置：</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[gluster-glustervol1]</span></span><br><span class=\"line\"><span class=\"attr\">comment</span> = For samba share of volume glustervol1</span><br><span class=\"line\">vfs objects = glusterfs</span><br><span class=\"line\">glusterfs:volume = glustervol1</span><br><span class=\"line\">glusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log</span><br><span class=\"line\">glusterfs:loglevel = 7</span><br><span class=\"line\"><span class=\"attr\">path</span> = /</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">guest ok = yes</span><br></pre></td></tr></table></figure>\n\n<p>在后面添加一行 <strong>kernel share modes = No</strong>。这个是为了解决挂载 samba 后创建文件后出现同时创建了多个文件的问题。具体原因不知道，如果有知道的可以交流一下。</p>\n<p>修改后为：</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[gluster-glustervol1]</span></span><br><span class=\"line\"><span class=\"attr\">comment</span> = For samba share of volume glustervol1</span><br><span class=\"line\">vfs objects = glusterfs</span><br><span class=\"line\">glusterfs:volume = glustervol1</span><br><span class=\"line\">glusterfs:logfile = /var/log/samba/glusterfs-glustervol1.%M.log</span><br><span class=\"line\">glusterfs:loglevel = 7</span><br><span class=\"line\"><span class=\"attr\">path</span> = /</span><br><span class=\"line\">read only = no</span><br><span class=\"line\">guest ok = yes</span><br><span class=\"line\">kernel share modes = No</span><br></pre></td></tr></table></figure>\n\n\n\n<p>为了能够访问 Samba 需要创建用户，并设置密码。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> smbpasswd -a sambauser</span></span><br></pre></td></tr></table></figure>\n\n<p>sambauser 是一个用户名，按需要进行创建。</p>\n<p>设置 SELinux 运行 Samba 共享：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> setsebool -P samba_share_fusefs on</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> setsebool -P samba_load_libgfapi on</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>当然也可以选择关闭 SELinux</p>\n<p>编辑<code>/etc/sysconfig/selinux</code></p>\n<p>将</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">SELINUX</span>=enforcing</span><br></pre></td></tr></table></figure>\n\n<p>改为</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">SELINUX</span>=disabled</span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t cifs \\\\\\\\gluster1.example.com\\\\gluster-glustervol1 /mnt/ -o user=sambauser,pass=mypassword</span></span><br></pre></td></tr></table></figure>\n\n<p>在 Windows 下 可以通过在资源管理器里添加一个新的位置来链接 Samba 共享。</p>\n<h3 id=\"NFS\"><a href=\"#NFS\" class=\"headerlink\" title=\"NFS\"></a>NFS</h3><p>需要开启 RPC 服务：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl <span class=\"built_in\">enable</span> rpcbind</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> systemctl start rpcbind</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>挂载：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> mount -t nfs gluster1.example.com:/glustervol1 /mnt/</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"Block-Storage\"><a href=\"#Block-Storage\" class=\"headerlink\" title=\"Block Storage\"></a>Block Storage</h2><p>块存储是非常常用的存储方式，GlusterFS 主要是文件存储，对于块存储要通过镜像文件的方式创建 iscsi target。</p>\n<p>这里推荐一个工具来创建帮助快速创建 <a href=\"https://github.com/gluster/gluster-block.git\" target=\"_blank\" rel=\"noopener\"><strong>gluster-block</strong></a> 。</p>\n<h2 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h2><blockquote>\n<p>CentOS Wiki: <a href=\"https://wiki.centos.org/zh/SpecialInterestGroup/Storage/gluster-Quickstart?highlight=%28GlusterFS%29\" target=\"_blank\" rel=\"noopener\">gluster-Quickstart</a>  <a href=\"https://wiki.centos.org/zh/HowTos/GlusterFSonCentOS?highlight=%28GlusterFS%29\" target=\"_blank\" rel=\"noopener\">GlusterFSonCentOS</a></p>\n<p>Gluster-Storage_GitBook: <a href=\"http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/\" target=\"_blank\" rel=\"noopener\">http://www.l-penguin.idv.tw/book/Gluster-Storage_GitBook/</a></p>\n</blockquote>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ck2iw6j9t0000vuqp697s6hwj","category_id":"ck2iw6ja30002vuqpezbb7hmb","_id":"ck2iw6ja70005vuqpdokocfjx"}],"PostTag":[{"post_id":"ck2iw6j9t0000vuqp697s6hwj","tag_id":"ck2iw6ja50003vuqp6zps2vz9","_id":"ck2iw6ja90007vuqpfwl013ar"},{"post_id":"ck2iw6j9t0000vuqp697s6hwj","tag_id":"ck2iw6ja60004vuqpawh5aurb","_id":"ck2iw6ja90008vuqpgv7f1vuv"},{"post_id":"ck2iw6j9t0000vuqp697s6hwj","tag_id":"ck2iw6ja70006vuqph6l70mx4","_id":"ck2iw6ja90009vuqpbng4d5tr"}],"Tag":[{"name":"Linux","_id":"ck2iw6ja50003vuqp6zps2vz9"},{"name":"Centos","_id":"ck2iw6ja60004vuqpawh5aurb"},{"name":"GlusterFS","_id":"ck2iw6ja70006vuqph6l70mx4"}]}}